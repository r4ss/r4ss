<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Creates a table of values that can be copied into the SS3 control file
for SS3 3.30 models to adjust the input sample sizes for length and age
compositions based on either the Francis or McAllister-Ianelli tuning or
adds the Dirichlet-Multinomial parameters to the necessary files to
tune the model using an integrated method.
Optionally, this function can automatically add these tunings to the
appropriate files and rerun the model for the desired number of iterations."><title>Calculate new tunings for length and age compositions and (re)run models — tune_comps • r4ss</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate new tunings for length and age compositions and (re)run models — tune_comps"><meta property="og:description" content="Creates a table of values that can be copied into the SS3 control file
for SS3 3.30 models to adjust the input sample sizes for length and age
compositions based on either the Francis or McAllister-Ianelli tuning or
adds the Dirichlet-Multinomial parameters to the necessary files to
tune the model using an integrated method.
Optionally, this function can automatically add these tunings to the
appropriate files and rerun the model for the desired number of iterations."><meta property="og:image" content="https://r4ss.github.io/r4ss/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">r4ss</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.48.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/example-plots.html">Example r4ss plots</a>
    <a class="dropdown-item" href="../articles/r4ss-intro-vignette.html">Introduction to r4ss</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r4ss/r4ss/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Calculate new tunings for length and age compositions and (re)run models</h1>
      <small class="dont-index">Source: <a href="https://github.com/r4ss/r4ss/blob/HEAD/R/tune_comps.R" class="external-link"><code>R/tune_comps.R</code></a></small>
      <div class="d-none name"><code>tune_comps.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Creates a table of values that can be copied into the SS3 control file
for SS3 3.30 models to adjust the input sample sizes for length and age
compositions based on either the Francis or McAllister-Ianelli tuning or
adds the Dirichlet-Multinomial parameters to the necessary files to
tune the model using an integrated method.
Optionally, this function can automatically add these tunings to the
appropriate files and rerun the model for the desired number of iterations.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tune_comps</span><span class="op">(</span></span>
<span>  replist <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fleets <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>  option <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Francis"</span>, <span class="st">"MI"</span>, <span class="st">"none"</span>, <span class="st">"DM"</span><span class="op">)</span>,</span>
<span>  digits <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  write <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  niters_tuning <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  init_run <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  exe <span class="op">=</span> <span class="st">"ss"</span>,</span>
<span>  model <span class="op">=</span> <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="https://lifecycle.r-lib.org/reference/deprecated.html" class="external-link">deprecated</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  extras <span class="op">=</span> <span class="st">""</span>,</span>
<span>  allow_up_tuning <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>replist</dt>
<dd><p>A list object created by <code><a href="SS_output.html">SS_output</a>()</code>.</p></dd>


<dt>fleets</dt>
<dd><p>Either the string "all", or a vector of numerical values, like
c(1,3), listing fleets or surveys to be included in the plot.</p></dd>


<dt>option</dt>
<dd><p>Which type of tuning: 'none', 'Francis', 'MI', or 'DM'.
The first option, <code>none</code>, will only return information about the
Francis and MI weights that are suggested.</p></dd>


<dt>digits</dt>
<dd><p>Number of digits to round numbers to.</p></dd>


<dt>write</dt>
<dd><p>Write suggested tunings to a file saved to the disk called
<code>suggested_tunings.ss</code>. This file name is currently hard coded and will
be saved in <code>dir</code>.</p></dd>


<dt>niters_tuning</dt>
<dd><p>The number of times to retune models. Defaults to 0,
where only the tunings should be calculated and the model is not rerun. Note
that for DM, it will be assumed that 0 means not to run the model and
specifying 1 or greater will only run the model once (because DM is not an
iterative retuning method).</p></dd>


<dt>init_run</dt>
<dd><p>Should the model be run before calculating the tunings?
Defaults to <code>FALSE</code>. This run is not counted as an iteration for
<code>niters_tuning</code> and will not be used if <code>option = "DM"</code>.</p></dd>


<dt>dir</dt>
<dd><p>A file path to the directory of interest.
The default value is <code>dir = NULL</code>, which leads to using
the current working directory.</p></dd>


<dt>exe</dt>
<dd><p>Executable name. Can be just the name of the executable
file if it is in the specified directory or in the user's PATH. Can
also include the absolute path or a path relative to the specified
directory. Needs to be a single character string, not a vector.
On Windows, <code>exe</code> can optionally have the <code>.exe</code> extension appended;
on Unix-based systems (i.e., Mac and Linux), no extension should be
included.</p></dd>


<dt>model</dt>
<dd><p>Deprecated. Use <code>exe</code> instead.</p></dd>


<dt>extras</dt>
<dd><p>Additional ADMB command line arguments passed
to the executable, such as "-nohess"</p></dd>


<dt>allow_up_tuning</dt>
<dd><p>Allow tuning values for Francis or MI &gt; 1? Defaults to
FALSE, which caps tuning values at 1.</p></dd>


<dt>verbose</dt>
<dd><p>A logical value specifying if output should be printed
to the screen.</p></dd>


<dt>...</dt>
<dd><p>Additional arguments passed to <code><a href="run.html">run()</a></code>, such as
<code>show_in_console</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Returns a table that can be copied into the control file.
If <code>write=TRUE</code> then will write the values to a file
(currently hardwired to go in the directory where the model was run
and called "suggested_tunings.ss").</p>
    </div>
    <div class="section level2">
    <h2 id="option"><code>option</code><a class="anchor" aria-label="anchor" href="#option"></a></h2>
    
<div class="section">
<h3 id="francis">Francis<a class="anchor" aria-label="anchor" href="#francis"></a></h3>


<p>The Francis approach to data weighting adjusts the input sample sizes using
a scalar such that the fit of the expected value is within the uncertainty
intervals based on the expected fit given adjusted sample sizes.</p>
</div>

<div class="section">
<h3 id="mcallister-ianelli-mi-">McAllister-Ianelli (MI)<a class="anchor" aria-label="anchor" href="#mcallister-ianelli-mi-"></a></h3>


<p>Also known as the Harmonic-Mean approach to data weighting, the
McAllister-Ianelli weighting approach uses a scalar to adjust the input
sample size of composition data based matching the arithmetic mean
of the input sample size to the harmonic mean of the effective sample size.</p>
</div>

<div class="section">
<h3 id="dirichlet-multinomial-dm-">Dirichlet-Multinomial (DM)<a class="anchor" aria-label="anchor" href="#dirichlet-multinomial-dm-"></a></h3>


<p>The Dirichlet-Multinomial likelihood is an alternative approach that allows
the tuning data type to be estimated rather than iteratively tuned.
Note that for <code>option = "DM"</code> a table of tunings is
not created as the DM is not an iterative reweighting option. Instead, each
of the fleets with length- and age-composition data will be assigned a DM
parameter and the model will be rerun.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="ss-versions">SS3 versions<a class="anchor" aria-label="anchor" href="#ss-versions"></a></h2>
    
<div class="section">
<h3 id="-">3.30.00-3.30.11<a class="anchor" aria-label="anchor" href="#-"></a></h3>


<p>Recommended_var_adj and other columns were named differently in these
early version of SS3. Calculations are thus done internally based on
finding the correct column name.</p>
</div>

<div class="section">
<h3 id="--1">3.30.12-3.30.16<a class="anchor" aria-label="anchor" href="#--1"></a></h3>


<p>Starting with SS3 version 3.30.12, the "Length_Comp_Fit_Summary"
table in Report.sso is already in the format required to paste into
the control file to apply the McAllister-Ianelli tuning. However, this
function provides the additional option of the Francis tuning and the
ability to compare the two approaches, as well as the functionality to add
tunings and rerun the model. The "Age_Comp_Fit_Summary" table in Report.sso
is formatted similarly though, though the Recommended_var_adj was wrongly
set to 1 for all fleets in SS3 versions 3.30.12 to 3.30.16. Thus, the
MI approach is not taken from this recommended column, instead, it is
calculated from the harmonic mean and input sample sizes.</p>
</div>

<div class="section">
<h3 id="--2">3.30.20<a class="anchor" aria-label="anchor" href="#--2"></a></h3>


<p>Starting with SS3 version 3.30.20, the Dirichlet-multinomial
likelihood was made available for Generalized Size Comp data. As part
of this change, the column names were changed for all fit summary
tables, to both align the notation among them and also facilitate the
future addition of the Multivariate-Tweedie likelihood.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Francis, R.I.C.C. (2011). Data weighting in statistical
fisheries stock assessment models. Can. J. Fish. Aquat. Sci. 68: 1124-1138.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other tuning functions: 
<code><a href="SSMethod.Cond.TA1.8.html">SSMethod.Cond.TA1.8</a>()</code>,
<code><a href="SSMethod.TA1.8.html">SSMethod.TA1.8</a>()</code></p>
<p>Other run functions: 
<code><a href="copy_SS_inputs.html">copy_SS_inputs</a>()</code>,
<code><a href="jitter.html">jitter</a>()</code>,
<code><a href="populate_multiple_folders.html">populate_multiple_folders</a>()</code>,
<code><a href="profile.html">profile</a>()</code>,
<code><a href="retro.html">retro</a>()</code>,
<code><a href="run.html">run</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Ian G. Taylor, Kathryn L. Doering</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># Set up the folders ----</span></span></span>
<span class="r-in"><span><span class="co"># Create a temporary directory, feel free to change this location</span></span></span>
<span class="r-in"><span><span class="va">mod_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"simple_mod"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Path to simple model in r4ss and copy files to mod_path</span></span></span>
<span class="r-in"><span><span class="va">example_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"simple_small"</span>, package <span class="op">=</span> <span class="st">"r4ss"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># copy model input files</span></span></span>
<span class="r-in"><span><span class="fu"><a href="copy_SS_inputs.html">copy_SS_inputs</a></span><span class="op">(</span>dir.old <span class="op">=</span> <span class="va">example_path</span>, dir.new <span class="op">=</span> <span class="va">mod_path</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># copy over the Report file</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">example_path</span>, <span class="st">"Report.sso"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mod_path</span>, <span class="st">"Report.sso"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># copy comp report file</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">example_path</span>, <span class="st">"CompReport.sso"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mod_path</span>, <span class="st">"CompReport.sso"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Use the tune_comps function----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Examples where a model is not run ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Just get the Francis and MI tables, without running the model. Note that the</span></span></span>
<span class="r-in"><span><span class="co"># model in mod_path needs to already have been run with Stock Synthesis, so</span></span></span>
<span class="r-in"><span><span class="co"># that a report file is available.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">weight_table</span> <span class="op">&lt;-</span> <span class="fu">tune_comps</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dir <span class="op">=</span> <span class="va">mod_path</span>,</span></span>
<span class="r-in"><span>  option <span class="op">=</span> <span class="st">"none"</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># view the weights. Note that the columns New_Francis and New_MI show the</span></span></span>
<span class="r-in"><span><span class="co"># weights, but neither were added to the New_Var_adj column</span></span></span>
<span class="r-in"><span><span class="va">weight_table</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Get the Francis and MI tables, but with the Francis weights in the</span></span></span>
<span class="r-in"><span><span class="co"># New_Var_adj column. Note if option = "MI" were used, the output would be</span></span></span>
<span class="r-in"><span><span class="co"># the same except that the New_Var_adj column would contain the MI weights.</span></span></span>
<span class="r-in"><span><span class="va">weight_table_fran</span> <span class="op">&lt;-</span> <span class="fu">tune_comps</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dir <span class="op">=</span> <span class="va">mod_path</span>,</span></span>
<span class="r-in"><span>  option <span class="op">=</span> <span class="st">"Francis"</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">weight_table_fran</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add Dirichlet-multinomial tuning parameters to the model,</span></span></span>
<span class="r-in"><span><span class="co"># without running it.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">DM_parm_info</span> <span class="op">&lt;-</span> <span class="fu">tune_comps</span><span class="op">(</span></span></span>
<span class="r-in"><span>  option <span class="op">=</span> <span class="st">"DM"</span>,</span></span>
<span class="r-in"><span>  niters_tuning <span class="op">=</span> <span class="fl">0</span>, <span class="co"># 0 means the model will not be run.</span></span></span>
<span class="r-in"><span>  dir <span class="op">=</span> <span class="va">mod_path</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># See the Dirichlet parameters added to the model.</span></span></span>
<span class="r-in"><span><span class="va">DM_parm_info</span><span class="op">[[</span><span class="st">"tuning_table_list"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># can also look in the data file to see which fleets of comp data now have</span></span></span>
<span class="r-in"><span><span class="co"># DM parameters. The "ParmSelect" column of the len_info and age_info</span></span></span>
<span class="r-in"><span><span class="co"># contains the dirichlet multinomial parameter numbers.</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="SS_readdat.html">SS_readdat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mod_path</span>, <span class="st">"simple_data.ss"</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">[[</span><span class="st">"len_info"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">dat</span><span class="op">[[</span><span class="st">"age_info"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Examples where models are run ----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Run MI weighting and allow upweighting for 1 iteration. Assume that an ss</span></span></span>
<span class="r-in"><span><span class="co"># executable called "ss or ss.exe" is available in the mod_path folder.</span></span></span>
<span class="r-in"><span><span class="co"># If the executable is not available, then the call will exit on error.</span></span></span>
<span class="r-in"><span><span class="co"># Note that the Dirichlet mulitnomial parameters will be removed, but any</span></span></span>
<span class="r-in"><span><span class="co"># previous tunings will be retained.</span></span></span>
<span class="r-in"><span><span class="va">tune_info</span> <span class="op">&lt;-</span> <span class="fu">tune_comps</span><span class="op">(</span></span></span>
<span class="r-in"><span>  option <span class="op">=</span> <span class="st">"MI"</span>,</span></span>
<span class="r-in"><span>  niters_tuning <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  dir <span class="op">=</span> <span class="va">mod_path</span>,</span></span>
<span class="r-in"><span>  allow_up_tuning <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  exe <span class="op">=</span> <span class="st">"ss"</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># see the tuning table, and the weights applied to the model.</span></span></span>
<span class="r-in"><span><span class="va">tune_info</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Add Dirichlet multinomial paramters and rerun. The function will</span></span></span>
<span class="r-in"><span><span class="co"># automatically remove the MI weighting and add in the DM parameters.</span></span></span>
<span class="r-in"><span><span class="co"># Use extras = "-nohess" when running model to speed up run.</span></span></span>
<span class="r-in"><span><span class="va">DM_parm_info</span> <span class="op">&lt;-</span> <span class="fu">tune_comps</span><span class="op">(</span></span></span>
<span class="r-in"><span>  option <span class="op">=</span> <span class="st">"DM"</span>,</span></span>
<span class="r-in"><span>  niters_tuning <span class="op">=</span> <span class="fl">1</span>, <span class="co"># must be 1 or greater to run</span></span></span>
<span class="r-in"><span>  dir <span class="op">=</span> <span class="va">mod_path</span>,</span></span>
<span class="r-in"><span>  extras <span class="op">=</span> <span class="st">"-nohess"</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># see the DM parameter estimates</span></span></span>
<span class="r-in"><span><span class="va">DM_parm_info</span><span class="op">[[</span><span class="st">"tuning_table_list"</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># cleanup ----</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">mod_path</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Ian G. Taylor, Ian J. Stewart, Allan C. Hicks, Tommy M. Garrison, Andre E. Punt, R.I.C. Chris Francis, John R. Wallace, Chantel R. Wetzel, James T. Thorson, Yukio Takeuchi, Kotaro Ono, Cole C. Monnahan, Christine C. Stawitz, Z. Teresa A’mar, Athol R. Whitten, Kelli F. Johnson, Robbie L. Emmet, Sean C. Anderson, Gwladys I. Lambert, Megan M. Stachura, Andrew B. Cooper, Andi Stephens, Neil L. Klaer, Carey R. McGilliard, Iago Mosqueira, Watal M. Iwasaki, Kathryn L. Doering, Andrea M. Havron, Nathan R. Vaughan, LaTreese S. Denson, Ashleigh J. Novak, Henning Winker, Lee Qi, Megumi Oshima, Eric Fletcher, Elizabeth F. Gugliotti.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>


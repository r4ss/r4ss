<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Uses method TA1.8 (described in Appendix A of Francis 2011) to do
stage-2 weighting of composition data from a Stock Synthesis model.
Outputs a multiplier, w (with bootstrap 95% confidence interval),
so that N2y = w x N1y, where N1y and
N2y are the stage-1 and stage-2
multinomial sample sizes for the data set in year y.  Optionally
makes a plot of observed (with confidence limits, based on N1y)
and expected mean lengths (or ages).

CAUTIONARY/EXPLANATORY NOTE.
The large number of options available in SS makes it very
difficult to be sure that what this function does is
appropriate for all combinations of options.  The following
notes might help anyone wanting to check or correct the code.
The code first takes the appropriate database (lendbase, sizedbase,
agedbase, or condbase) and removes unneeded rows.
The remaining rows of the database are grouped into individual
comps (indexed by vector indx) and relevant statistics (e.g.,
observed and expected mean length or age), and ancillary data,
are calculated for each comp (these are stored in pldat - one row
per comp).
If the data are to be plotted, the comps are grouped, with each
group corresponding to a panel in the plot, and groups are indexed
by plindx.
A single multiplier is calculated to apply to all the comps.

"><title>Apply Francis composition weighting method TA1.8 — SSMethod.TA1.8 • r4ss</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Apply Francis composition weighting method TA1.8 — SSMethod.TA1.8"><meta property="og:description" content="Uses method TA1.8 (described in Appendix A of Francis 2011) to do
stage-2 weighting of composition data from a Stock Synthesis model.
Outputs a multiplier, w (with bootstrap 95% confidence interval),
so that N2y = w x N1y, where N1y and
N2y are the stage-1 and stage-2
multinomial sample sizes for the data set in year y.  Optionally
makes a plot of observed (with confidence limits, based on N1y)
and expected mean lengths (or ages).

CAUTIONARY/EXPLANATORY NOTE.
The large number of options available in SS makes it very
difficult to be sure that what this function does is
appropriate for all combinations of options.  The following
notes might help anyone wanting to check or correct the code.
The code first takes the appropriate database (lendbase, sizedbase,
agedbase, or condbase) and removes unneeded rows.
The remaining rows of the database are grouped into individual
comps (indexed by vector indx) and relevant statistics (e.g.,
observed and expected mean length or age), and ancillary data,
are calculated for each comp (these are stored in pldat - one row
per comp).
If the data are to be plotted, the comps are grouped, with each
group corresponding to a panel in the plot, and groups are indexed
by plindx.
A single multiplier is calculated to apply to all the comps.

"><meta property="og:image" content="https://r4ss.github.io/r4ss/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">r4ss</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.48.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/example-plots.html">Example r4ss plots</a>
    <a class="dropdown-item" href="../articles/r4ss-intro-vignette.html">Introduction to r4ss</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r4ss/r4ss/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Apply Francis composition weighting method TA1.8</h1>
      <small class="dont-index">Source: <a href="https://github.com/r4ss/r4ss/blob/HEAD/R/SSMethod.TA1.8.R" class="external-link"><code>R/SSMethod.TA1.8.R</code></a></small>
      <div class="d-none name"><code>SSMethod.TA1.8.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Uses method TA1.8 (described in Appendix A of Francis 2011) to do
stage-2 weighting of composition data from a Stock Synthesis model.
Outputs a multiplier, <em>w</em> (with bootstrap 95% confidence interval),
so that <em>N2y</em> = <em>w</em> x <em>N1y</em>, where <em>N1y</em> and
<em>N2y</em> are the stage-1 and stage-2
multinomial sample sizes for the data set in year y.  Optionally
makes a plot of observed (with confidence limits, based on <em>N1y</em>)
and expected mean lengths (or ages).
<br><br>
CAUTIONARY/EXPLANATORY NOTE.
The large number of options available in SS makes it very
difficult to be sure that what this function does is
appropriate for all combinations of options.  The following
notes might help anyone wanting to check or correct the code.</p><ol><li><p>The code first takes the appropriate database (lendbase, sizedbase,
agedbase, or condbase) and removes unneeded rows.</p></li>
<li><p>The remaining rows of the database are grouped into individual
comps (indexed by vector indx) and relevant statistics (e.g.,
observed and expected mean length or age), and ancillary data,
are calculated for each comp (these are stored in pldat - one row
per comp).
If the data are to be plotted, the comps are grouped, with each
group corresponding to a panel in the plot, and groups are indexed
by plindx.</p></li>
<li><p>A single multiplier is calculated to apply to all the comps.</p></li>
</ol></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">SSMethod.TA1.8</span><span class="op">(</span></span>
<span>  <span class="va">fit</span>,</span>
<span>  <span class="va">type</span>,</span>
<span>  <span class="va">fleet</span>,</span>
<span>  part <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>  sexes <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">3</span>,</span>
<span>  seas <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plotit <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  printit <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  datonly <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  plotadj <span class="op">=</span> <span class="op">!</span><span class="va">datonly</span>,</span>
<span>  maxpanel <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  fleetnames <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  label.part <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  label.sex <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  set.pars <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  add <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>fit</dt>
<dd><p>Stock Synthesis output as read by r4SS function SS_output</p></dd>


<dt>type</dt>
<dd><p>either 'len' (for length composition data), 'size' (for
generalized size composition data), 'age' (for age composition data),
or 'con' (for conditional age at length data)</p></dd>


<dt>fleet</dt>
<dd><p>vector of one or more fleet numbers whose data are to
be analysed simultaneously (the output N multiplier applies
to all fleets combined)</p></dd>


<dt>part</dt>
<dd><p>vector of one or more partition values; analysis is restricted
to composition data with one of these partition values.
Default is to include all partition values (0, 1, 2).</p></dd>


<dt>sexes</dt>
<dd><p>vector of one or more values for Sexes; analysis is
restricted to composition data with one of these
Sexes values.  Ignored if type=='con'.</p></dd>


<dt>seas</dt>
<dd><p>string indicating how to treat data from multiple seasons
'comb' - combine seasonal data for each year and plot against Yr
'sep' - treat seasons separately, plotting against Yr.S
If is.null(seas) it is assumed that there is only one season in
the selected data (a warning is output if this is not true) and
option 'comb' is used.</p></dd>


<dt>method</dt>
<dd><p>a vector of one or more size-frequency method numbers
(ignored unless type = 'size').
If !is.null(method), analysis is restricted to size-frequency
methods in this vector.  NB comps are separated by method</p></dd>


<dt>plotit</dt>
<dd><p>if TRUE, make an illustrative plot like one or more
panels of Fig. 4 in Francis (2011).</p></dd>


<dt>printit</dt>
<dd><p>if TRUE, print results to R console.</p></dd>


<dt>datonly</dt>
<dd><p>if TRUE, don't show the model expectations</p></dd>


<dt>plotadj</dt>
<dd><p>if TRUE, plot the confidence intervals associated with
the adjusted sample sizes (TRUE by default unless datonly = TRUE)</p></dd>


<dt>maxpanel</dt>
<dd><p>maximum number of panels within a plot</p></dd>


<dt>fleetnames</dt>
<dd><p>Optional replacement for fleetnames used in data file.</p></dd>


<dt>label.part</dt>
<dd><p>Include labels indicating which partitions are included?</p></dd>


<dt>label.sex</dt>
<dd><p>Include labels indicating which sexes are included?</p></dd>


<dt>set.pars</dt>
<dd><p>Set the graphical parameters such as mar and mfrow.
Can be set to FALSE in order to add plots form multiple calls to
this function as separate panels in one larger figure.</p></dd>


<dt>add</dt>
<dd><p>add to existing plot</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Francis, R.I.C.C. (2011). Data weighting in statistical
fisheries stock assessment models. Canadian Journal of
Fisheries and Aquatic Sciences 68: 1124-1138.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other tuning functions: 
<code><a href="SSMethod.Cond.TA1.8.html">SSMethod.Cond.TA1.8</a>()</code>,
<code><a href="tune_comps.html">tune_comps</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>R.I.C Chris Francis, Andre E. Punt, Ian G. Taylor</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="va">Nfleet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">myreplist</span><span class="op">[[</span><span class="st">"FleetNames"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">Ifleet</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">Nfleet</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">SSMethod.TA1.8</span><span class="op">(</span><span class="va">myreplist</span>, <span class="st">"len"</span>, fleet <span class="op">=</span> <span class="va">Ifleet</span>, maxpanel <span class="op">=</span> <span class="va">maxpanel</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">Ifleet</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">Nfleet</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">SSMethod.TA1.8</span><span class="op">(</span><span class="va">myreplist</span>, <span class="st">"age"</span>, fleet <span class="op">=</span> <span class="va">Ifleet</span>, maxpanel <span class="op">=</span> <span class="va">maxpanel</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">Ifleet</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">Nfleet</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">SSMethod.TA1.8</span><span class="op">(</span><span class="va">myreplist</span>, <span class="st">"size"</span>, fleet <span class="op">=</span> <span class="va">Ifleet</span>, maxpanel <span class="op">=</span> <span class="va">maxpanel</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">Ifleet</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">Nfleet</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu">SSMethod.TA1.8</span><span class="op">(</span><span class="va">myreplist</span>, <span class="st">"con"</span>, fleet <span class="op">=</span> <span class="va">Ifleet</span>, maxpanel <span class="op">=</span> <span class="va">maxpanel</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="kw">for</span> <span class="op">(</span><span class="va">Ifleet</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">Nfleet</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="SSMethod.Cond.TA1.8.html">SSMethod.Cond.TA1.8</a></span><span class="op">(</span><span class="va">myreplist</span>, fleet <span class="op">=</span> <span class="va">Ifleet</span>, maxpanel <span class="op">=</span> <span class="va">maxpanel</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Ian G. Taylor, Ian J. Stewart, Allan C. Hicks, Tommy M. Garrison, Andre E. Punt, R.I.C. Chris Francis, John R. Wallace, Chantel R. Wetzel, James T. Thorson, Yukio Takeuchi, Kotaro Ono, Cole C. Monnahan, Christine C. Stawitz, Z. Teresa A’mar, Athol R. Whitten, Kelli F. Johnson, Robbie L. Emmet, Sean C. Anderson, Gwladys I. Lambert, Megan M. Stachura, Andrew B. Cooper, Andi Stephens, Neil L. Klaer, Carey R. McGilliard, Iago Mosqueira, Watal M. Iwasaki, Kathryn L. Doering, Andrea M. Havron, Nathan R. Vaughan, LaTreese S. Denson, Ashleigh J. Novak, Henning Winker, Lee Qi, Megumi Oshima, Eric Fletcher, Elizabeth F. Gugliotti.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>


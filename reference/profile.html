<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Run a likelihood profile in Stock Synthesis. — profile • r4ss</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run a likelihood profile in Stock Synthesis. — profile"><meta name="description" content="Iteratively changes the control file for the chosen parameter. This
function was formerly called SS_profile()."><meta property="og:description" content="Iteratively changes the control file for the chosen parameter. This
function was formerly called SS_profile()."><meta property="og:image" content="https://r4ss.github.io/r4ss/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">r4ss</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.50.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/example-plots.html">Example r4ss plots</a></li>
    <li><a class="dropdown-item" href="../articles/r4ss-intro-vignette.html">Introduction to r4ss</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r4ss/r4ss/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Run a likelihood profile in Stock Synthesis.</h1>
      <small class="dont-index">Source: <a href="https://github.com/r4ss/r4ss/blob/main/R/profile.R" class="external-link"><code>R/profile.R</code></a></small>
      <div class="d-none name"><code>profile.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Iteratively changes the control file for the chosen parameter. This
function was formerly called <code><a href="SS_profile.html">SS_profile()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">profile</span><span class="op">(</span></span>
<span>  <span class="va">dir</span>,</span>
<span>  oldctlfile <span class="op">=</span> <span class="st">"control.ss_new"</span>,</span>
<span>  masterctlfile <span class="op">=</span> <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="https://lifecycle.r-lib.org/reference/deprecated.html" class="external-link">deprecated</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  newctlfile <span class="op">=</span> <span class="st">"control_modified.ss"</span>,</span>
<span>  linenum <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  string <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  profilevec <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  usepar <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  globalpar <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  parlinenum <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parstring <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  saveoutput <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  whichruns <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  prior_check <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  read_like <span class="op">=</span> <span class="fu">lifecycle</span><span class="fu">::</span><span class="fu"><a href="https://lifecycle.r-lib.org/reference/deprecated.html" class="external-link">deprecated</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  exe <span class="op">=</span> <span class="st">"ss3"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  conv_criteria <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dir">dir<a class="anchor" aria-label="anchor" href="#arg-dir"></a></dt>
<dd><p>A file path to the directory of interest.
The default value is <code>dir = NULL</code>, which leads to using
the current working directory.</p></dd>


<dt id="arg-oldctlfile">oldctlfile<a class="anchor" aria-label="anchor" href="#arg-oldctlfile"></a></dt>
<dd><p>Source control file. Default = "control.ss_new"</p></dd>


<dt id="arg-masterctlfile">masterctlfile<a class="anchor" aria-label="anchor" href="#arg-masterctlfile"></a></dt>
<dd><p>Deprecated. Use <code>oldctlfile</code> instead.</p></dd>


<dt id="arg-newctlfile">newctlfile<a class="anchor" aria-label="anchor" href="#arg-newctlfile"></a></dt>
<dd><p>Destination for new control files (must match entry in
starter file). Default = "control_modified.ss".</p></dd>


<dt id="arg-linenum">linenum<a class="anchor" aria-label="anchor" href="#arg-linenum"></a></dt>
<dd><p>Line number of parameter to be changed. Can be used instead
of <code>string</code> or left as NULL. Can be a vector if you are profiling multiple
parameters at the same time.</p></dd>


<dt id="arg-string">string<a class="anchor" aria-label="anchor" href="#arg-string"></a></dt>
<dd><p>String partially matching name of parameter to be changed. Can
be used instead of <code>linenum</code> or left as NULL. Can be a vector if you are
profiling multiple parameters at the same time.</p></dd>


<dt id="arg-profilevec">profilevec<a class="anchor" aria-label="anchor" href="#arg-profilevec"></a></dt>
<dd><p>Vector of values to profile over. If you are profileing
over multiple parameters at the same time this should be a data.frame or
matrix with a column for each parameter.</p></dd>


<dt id="arg-usepar">usepar<a class="anchor" aria-label="anchor" href="#arg-usepar"></a></dt>
<dd><p>Use PAR file from previous profile step for starting values?</p></dd>


<dt id="arg-globalpar">globalpar<a class="anchor" aria-label="anchor" href="#arg-globalpar"></a></dt>
<dd><p>Use global par file (<code>parfile_original_backup.sso</code>, which is
automatically copied from original <code>ss.par</code> or <code>ss3.par</code> depending on SS3
version) for all runs instead of the par file from each successive run</p></dd>


<dt id="arg-parlinenum">parlinenum<a class="anchor" aria-label="anchor" href="#arg-parlinenum"></a></dt>
<dd><p>Line number in par file to change (if usepar = TRUE).
Can be a vector if you are profiling multiple parameters at the same time.</p></dd>


<dt id="arg-parstring">parstring<a class="anchor" aria-label="anchor" href="#arg-parstring"></a></dt>
<dd><p>String in par file preceding line number to change as
an alternative to parlinenum (only needed if usepar = TRUE).
Can be a vector if you are profiling multiple parameters at the same time.</p></dd>


<dt id="arg-saveoutput">saveoutput<a class="anchor" aria-label="anchor" href="#arg-saveoutput"></a></dt>
<dd><p>Copy output .sso files to unique names.  Default = TRUE.</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>Overwrite any existing .sso files. Default = TRUE. If FALSE,
then some runs may be skipped.</p></dd>


<dt id="arg-whichruns">whichruns<a class="anchor" aria-label="anchor" href="#arg-whichruns"></a></dt>
<dd><p>Optional vector of run indices to do. This can be used to
re-run a subset of the cases in situations where the function was
interrupted or some runs fail to converge. Must be a subset of 1:n, where n
is the length of profilevec.</p></dd>


<dt id="arg-prior-check">prior_check<a class="anchor" aria-label="anchor" href="#arg-prior-check"></a></dt>
<dd><p>Check to make sure the starter file is set to include
the prior likelihood contribution in the total likelihood.  Default = TRUE.</p></dd>


<dt id="arg-read-like">read_like<a class="anchor" aria-label="anchor" href="#arg-read-like"></a></dt>
<dd><p>Deprecated.</p></dd>


<dt id="arg-exe">exe<a class="anchor" aria-label="anchor" href="#arg-exe"></a></dt>
<dd><p>Executable name. Can be just the name of the executable
file if it is in the specified directory or in the user's PATH. Can
also include the absolute path or a path relative to the specified
directory. Needs to be a single character string, not a vector.
On Windows, <code>exe</code> can optionally have the <code>.exe</code> extension appended;
on Unix-based systems (i.e., Mac and Linux), no extension should be
included.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>A logical value specifying if output should be printed
to the screen.</p></dd>


<dt id="arg-conv-criteria">conv_criteria<a class="anchor" aria-label="anchor" href="#arg-conv-criteria"></a></dt>
<dd><p>Maximum gradient for a model to be considered converged.
Defaults to 0.01.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to <code><a href="run.html">run()</a></code>, such as
<code>extras</code>, <code>show_in_console</code>, and <code>skipfinished</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The starting values used in this profile are not ideal and some models
may not converge. Care should be taken in using an automated tool like this,
and some models are likely to require rerunning with alternate starting
values.</p>
<p>To run multiple models simultaneously using parallel computing, see
<code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan()</a></code>. However, when running models in parallel, you cannot
iteratively adapt the starting values using <code>usepar = TRUE</code> and
<code>globalpar = FALSE</code>. This increases the chances that some of your models do
not converge.</p>
<p>Also, someday this function will be improved to work directly with the
plotting function <code><a href="SSplotProfile.html">SSplotProfile()</a></code>, but they don't yet work well
together. Thus, even if <code>profile()</code> is used, the output should
be read using <code><a href="SSgetoutput.html">SSgetoutput()</a></code> or by multiple calls to
<code><a href="SS_output.html">SS_output()</a></code> before sending to <code><a href="SSplotProfile.html">SSplotProfile()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="SSgetoutput.html">SSgetoutput()</a></code>,
<code><a href="SS_changepars.html">SS_changepars()</a></code>, <code><a href="SS_parlines.html">SS_parlines()</a></code></p>
<p>Other run functions:
<code><a href="copy_SS_inputs.html">copy_SS_inputs</a>()</code>,
<code><a href="jitter.html">jitter</a>()</code>,
<code><a href="populate_multiple_folders.html">populate_multiple_folders</a>()</code>,
<code><a href="retro.html">retro</a>()</code>,
<code><a href="run.html">run</a>()</code>,
<code><a href="tune_comps.html">tune_comps</a>()</code></p>
<p>Other profile functions:
<code><a href="PinerPlot.html">PinerPlot</a>()</code>,
<code><a href="SSplotProfile.html">SSplotProfile</a>()</code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Ian G. Taylor, Kathryn L. Doering, Kelli F. Johnson,
Chantel R. Wetzel, James T. Thorson, Kiva L. Oken</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###########################################################################</span></span></span>
<span class="r-in"><span><span class="co"># example profile</span></span></span>
<span class="r-in"><span><span class="co"># (assumes you have an SS3 exe called "ss3.exe" or "ss3" in your PATH)</span></span></span>
<span class="r-in"><span><span class="co">###########################################################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># directory for "simple_small" example model included with r4ss</span></span></span>
<span class="r-in"><span><span class="va">dir_simple_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"r4ss"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"simple_small"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create temporary directory and copy files into it</span></span></span>
<span class="r-in"><span><span class="va">dir_prof</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"profile"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="copy_SS_inputs.html">copy_SS_inputs</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  dir.old <span class="op">=</span> <span class="va">dir_simple_small</span>,</span></span>
<span class="r-in"><span>  dir.new <span class="op">=</span> <span class="va">dir_prof</span>,</span></span>
<span class="r-in"><span>  create.dir <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  copy_par <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># the following commands related to starter.ss could be done by hand</span></span></span>
<span class="r-in"><span><span class="co"># read starter file</span></span></span>
<span class="r-in"><span><span class="va">starter</span> <span class="op">&lt;-</span> <span class="fu"><a href="SS_readstarter.html">SS_readstarter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_prof</span>, <span class="st">"starter.ss"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># change control file name in the starter file</span></span></span>
<span class="r-in"><span><span class="va">starter</span><span class="op">[[</span><span class="st">"ctlfile"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"control_modified.ss"</span></span></span>
<span class="r-in"><span><span class="co"># make sure the prior likelihood is calculated</span></span></span>
<span class="r-in"><span><span class="co"># for non-estimated quantities</span></span></span>
<span class="r-in"><span><span class="va">starter</span><span class="op">[[</span><span class="st">"prior_like"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span><span class="co"># write modified starter file</span></span></span>
<span class="r-in"><span><span class="fu"><a href="SS_writestarter.html">SS_writestarter</a></span><span class="op">(</span><span class="va">starter</span>, dir <span class="op">=</span> <span class="va">dir_prof</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># vector of values to profile over</span></span></span>
<span class="r-in"><span><span class="va">h.vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.9</span>, <span class="fl">.1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Nprofile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">h.vec</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># run profile command</span></span></span>
<span class="r-in"><span><span class="va">prof.table</span> <span class="op">&lt;-</span> <span class="fu">profile</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dir <span class="op">=</span> <span class="va">dir_prof</span>,</span></span>
<span class="r-in"><span>  oldctlfile <span class="op">=</span> <span class="st">"control.ss"</span>,</span></span>
<span class="r-in"><span>  newctlfile <span class="op">=</span> <span class="st">"control_modified.ss"</span>,</span></span>
<span class="r-in"><span>  string <span class="op">=</span> <span class="st">"steep"</span>, <span class="co"># subset of parameter label</span></span></span>
<span class="r-in"><span>  profilevec <span class="op">=</span> <span class="va">h.vec</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># read the output files (with names like Report1.sso, Report2.sso, etc.)</span></span></span>
<span class="r-in"><span><span class="va">profilemodels</span> <span class="op">&lt;-</span> <span class="fu"><a href="SSgetoutput.html">SSgetoutput</a></span><span class="op">(</span>dirvec <span class="op">=</span> <span class="va">dir_prof</span>, keyvec <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">Nprofile</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># summarize output</span></span></span>
<span class="r-in"><span><span class="va">profilesummary</span> <span class="op">&lt;-</span> <span class="fu"><a href="SSsummarize.html">SSsummarize</a></span><span class="op">(</span><span class="va">profilemodels</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># OPTIONAL COMMANDS TO ADD MODEL WITH PROFILE PARAMETER ESTIMATED</span></span></span>
<span class="r-in"><span><span class="co"># (in the "simple_small" example, steepness is fixed so it doesn't</span></span></span>
<span class="r-in"><span><span class="co"># have any impact)</span></span></span>
<span class="r-in"><span><span class="va">MLEmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="SS_output.html">SS_output</a></span><span class="op">(</span><span class="va">dir_simple_small</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, printstats <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">profilemodels</span><span class="op">[[</span><span class="st">"MLE"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">MLEmodel</span></span></span>
<span class="r-in"><span><span class="va">profilesummary</span> <span class="op">&lt;-</span> <span class="fu"><a href="SSsummarize.html">SSsummarize</a></span><span class="op">(</span><span class="va">profilemodels</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># END OPTIONAL COMMANDS</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot profile using summary created above</span></span></span>
<span class="r-in"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="SSplotProfile.html">SSplotProfile</a></span><span class="op">(</span><span class="va">profilesummary</span>, <span class="co"># summary object</span></span></span>
<span class="r-in"><span>  profile.string <span class="op">=</span> <span class="st">"steep"</span>, <span class="co"># substring of profile parameter</span></span></span>
<span class="r-in"><span>  profile.label <span class="op">=</span> <span class="st">"Stock-recruit steepness (h)"</span></span></span>
<span class="r-in"><span><span class="op">)</span> <span class="co"># axis label</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># make timeseries plots comparing models in profile</span></span></span>
<span class="r-in"><span><span class="fu"><a href="SSplotComparisons.html">SSplotComparisons</a></span><span class="op">(</span><span class="va">profilesummary</span>, legendlabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"h ="</span>, <span class="va">h.vec</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run same profile in parallel</span></span></span>
<span class="r-in"><span><span class="va">ncores</span> <span class="op">&lt;-</span> <span class="fu">parallelly</span><span class="fu">::</span><span class="fu"><a href="https://parallelly.futureverse.org/reference/availableCores.html" class="external-link">availableCores</a></span><span class="op">(</span>omit <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="va"><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">multisession</a></span>, workers <span class="op">=</span> <span class="va">ncores</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">prof.table</span> <span class="op">&lt;-</span> <span class="fu">profile</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dir <span class="op">=</span> <span class="va">dir_prof</span>,</span></span>
<span class="r-in"><span>  oldctlfile <span class="op">=</span> <span class="st">"control.ss"</span>,</span></span>
<span class="r-in"><span>  newctlfile <span class="op">=</span> <span class="st">"control_modified.ss"</span>,</span></span>
<span class="r-in"><span>  string <span class="op">=</span> <span class="st">"steep"</span>, <span class="co"># subset of parameter label</span></span></span>
<span class="r-in"><span>  profilevec <span class="op">=</span> <span class="va">h.vec</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="va"><a href="https://future.futureverse.org/reference/sequential.html" class="external-link">sequential</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###########################################################################</span></span></span>
<span class="r-in"><span><span class="co"># example two-dimensional profile</span></span></span>
<span class="r-in"><span><span class="co"># (assumes you have an SS3 exe called "ss3.exe" or "ss3" in your PATH)</span></span></span>
<span class="r-in"><span><span class="co">###########################################################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dir_simple_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"r4ss"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"simple_small"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create temporary directory and copy files into it</span></span></span>
<span class="r-in"><span><span class="va">dir_prof</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"profile_2D"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="copy_SS_inputs.html">copy_SS_inputs</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  dir.old <span class="op">=</span> <span class="va">dir_simple_small</span>,</span></span>
<span class="r-in"><span>  dir.new <span class="op">=</span> <span class="va">dir_prof</span>,</span></span>
<span class="r-in"><span>  create.dir <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  copy_par <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># create table of M values for females and males</span></span></span>
<span class="r-in"><span><span class="va">par_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  M1vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  M2vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.10</span>, <span class="fl">0.15</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run model once to create control.ss_new with</span></span></span>
<span class="r-in"><span><span class="co"># good starting parameter values</span></span></span>
<span class="r-in"><span><span class="co"># exe is assumed to be in PATH, add "exe" argument if needed</span></span></span>
<span class="r-in"><span><span class="fu"><a href="run.html">run</a></span><span class="op">(</span><span class="va">dir_prof</span>, extras <span class="op">=</span> <span class="st">"-nohess"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run profile using ss_new file as parameter source and</span></span></span>
<span class="r-in"><span><span class="co"># overwriting original control file with new values</span></span></span>
<span class="r-in"><span><span class="va">prof.table</span> <span class="op">&lt;-</span> <span class="fu">profile</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dir <span class="op">=</span> <span class="va">dir_prof</span>,</span></span>
<span class="r-in"><span>  oldctlfile <span class="op">=</span> <span class="st">"control.ss_new"</span>,</span></span>
<span class="r-in"><span>  newctlfile <span class="op">=</span> <span class="st">"control.ss"</span>,</span></span>
<span class="r-in"><span>  string <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"NatM_uniform_Fem_GP_1"</span>, <span class="st">"NatM_uniform_Mal_GP_1"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  profilevec <span class="op">=</span> <span class="va">par_table</span>,</span></span>
<span class="r-in"><span>  extras <span class="op">=</span> <span class="st">"-nohess"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># get model output</span></span></span>
<span class="r-in"><span><span class="va">profilemodels</span> <span class="op">&lt;-</span> <span class="fu"><a href="SSgetoutput.html">SSgetoutput</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  dirvec <span class="op">=</span> <span class="va">dir_prof</span>,</span></span>
<span class="r-in"><span>  keyvec <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">par_table</span><span class="op">)</span>, getcovar <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">profilemodels</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">profilesummary</span> <span class="op">&lt;-</span> <span class="fu"><a href="SSsummarize.html">SSsummarize</a></span><span class="op">(</span><span class="va">profilemodels</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add total likelihood (row 1) to table created above</span></span></span>
<span class="r-in"><span><span class="va">par_table</span><span class="op">[[</span><span class="st">"like"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">profilesummary</span><span class="op">[[</span><span class="st">"likelihoods"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># reshape data frame into a matrix for use with contour</span></span></span>
<span class="r-in"><span><span class="va">like_matrix</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/cast.html" class="external-link">acast</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">par_table</span>,</span></span>
<span class="r-in"><span>  formula <span class="op">=</span> <span class="va">M1vec</span> <span class="op">~</span> <span class="va">M2vec</span>,</span></span>
<span class="r-in"><span>  value.var <span class="op">=</span> <span class="st">"like"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># look at change relative to the minimum</span></span></span>
<span class="r-in"><span><span class="co"># (shows small change when female and male M are equal,</span></span></span>
<span class="r-in"><span><span class="co"># big change when they are different)</span></span></span>
<span class="r-in"><span><span class="va">like_matrix</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">like_matrix</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#         0.05    0.1    0.15</span></span></span>
<span class="r-in"><span><span class="co"># 0.05   6.938 32.710 121.959</span></span></span>
<span class="r-in"><span><span class="co"># 0.1   49.706  0.000  27.678</span></span></span>
<span class="r-in"><span><span class="co"># 0.15 154.897 44.768   5.366</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ian G. Taylor, Ian J. Stewart, Allan C. Hicks, Tommy M. Garrison, Andre E. Punt, R.I.C. Chris Francis, John R. Wallace, Chantel R. Wetzel, James T. Thorson, Yukio Takeuchi, Kotaro Ono, Cole C. Monnahan, Christine C. Stawitz, Z. Teresa A’mar, Athol R. Whitten, Kelli F. Johnson, Robbie L. Emmet, Sean C. Anderson, Gwladys I. Lambert, Megan M. Stachura, Andrew B. Cooper, Andi Stephens, Neil L. Klaer, Carey R. McGilliard, Iago Mosqueira, Watal M. Iwasaki, Kathryn L. Doering, Andrea M. Havron, Nathan R. Vaughan, LaTreese S. Denson, Ashleigh J. Novak, Henning Winker, Lee Qi, Megumi Oshima, Eric Fletcher, Elizabeth F. Gugliotti, Kiva L. Oken.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>


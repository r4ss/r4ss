<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to r4ss • r4ss</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to r4ss">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">r4ss</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.49.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/example-plots.html">Example r4ss plots</a></li>
    <li><a class="dropdown-item" href="../articles/r4ss-intro-vignette.html">Introduction to r4ss</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r4ss/r4ss/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Introduction to r4ss</h1>
                        <h4 data-toc-skip class="author">Ian G. Taylor
and Kathryn L. Doering</h4>
            
            <h4 data-toc-skip class="date">2024-07-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/r4ss/r4ss/blob/main/vignettes/r4ss-intro-vignette.Rmd" class="external-link"><code>vignettes/r4ss-intro-vignette.Rmd</code></a></small>
      <div class="d-none name"><code>r4ss-intro-vignette.Rmd</code></div>
    </div>

    
    
<p><strong>r4ss</strong> is an R package containing functions related to
the <a href="https://vlab.noaa.gov/web/stock-synthesis" class="external-link">Stock Synthesis
fisheries stock assessment modeling framework</a>. This vignette covers
installing the package and an overview of functions.</p>
<div class="section level2">
<h2 id="installing-the-r4ss-r-package">Installing the r4ss R package<a class="anchor" aria-label="anchor" href="#installing-the-r4ss-r-package"></a>
</h2>
<div class="section level3">
<h3 id="basic-installation">Basic installation<a class="anchor" aria-label="anchor" href="#basic-installation"></a>
</h3>
<p>The package can be run on OS X, Windows, or Linux. The CRAN version
of r4ss is not as regularly updated and therefore may be out of date.
Instead, it is recommended to install from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("pak") # if needed</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pkg_install.html" class="external-link">pkg_install</a></span><span class="op">(</span><span class="st">"r4ss/r4ss"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="loading-the-package-and-reading-help-pages">Loading the package and reading help pages<a class="anchor" aria-label="anchor" href="#loading-the-package-and-reading-help-pages"></a>
</h3>
<p>You can then load the package with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/r4ss/r4ss" class="external-link">"r4ss"</a></span><span class="op">)</span></span></code></pre></div>
<p>And read the help files with:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">r4ss</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/help.html" class="external-link">help</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"r4ss"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="alternative-versions">Alternative versions<a class="anchor" aria-label="anchor" href="#alternative-versions"></a>
</h3>
<p>Although we’ve made an effort to maintain backward compatibility to
at least Stock Synthesis version 3.24S (from July 2013), there may be
cases where it’s necessary to install either an older version of r4ss,
such as when a recent change to the package causes something to fail, or
a development version of the package that isn’t in the <code>main</code>
branch yet, such as to test upcoming features.</p>
<p>To install alternative versions of r4ss, provide a reference to the
<code>install_github</code>, such as</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">pak</span><span class="fu">::</span><span class="fu"><a href="https://pak.r-lib.org/reference/pkg_install.html" class="external-link">pkg_install</a></span><span class="op">(</span><span class="st">"r4ss/r4ss@1.46.1"</span><span class="op">)</span> <span class="co"># install r4ss version 1.46.1</span></span></code></pre></div>
<p>where the <code>ref</code> input can be a release number, the name of
a branch on GitHub, or a git SHA-1 code, which are <a href="https://github.com/r4ss/r4ss/commits/" class="external-link">listed with all code
changes committed</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="plot">Reading model output and making default plots<a class="anchor" aria-label="anchor" href="#plot"></a>
</h2>
<p>The most important two functions are <code><a href="../reference/SS_output.html">SS_output()</a></code> and
<code><a href="../reference/SS_plots.html">SS_plots()</a></code>, the first for reading the output from a Stock
Synthesis model and the second for making a large set of plots
illustrating that output.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># it's useful to create a variable for the directory with the model output</span></span>
<span><span class="va">mydir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/find.package.html" class="external-link">path.package</a></span><span class="op">(</span><span class="st">"r4ss"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"simple_small"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read the model output and print diagnostic messages</span></span>
<span><span class="va">replist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SS_output.html">SS_output</a></span><span class="op">(</span></span>
<span>  dir <span class="op">=</span> <span class="va">mydir</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  printstats <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plots the results</span></span>
<span><span class="fu"><a href="../reference/SS_plots.html">SS_plots</a></span><span class="op">(</span><span class="va">replist</span><span class="op">)</span></span></code></pre></div>
<p>By default <code><a href="../reference/SS_plots.html">SS_plots()</a></code> creates PNG and HTML files in a
new <code>plots</code> sub-directory in the same location as the model
files. The HTML files (example excerpt below) facilitate exploration of
the png figures. The home tab should open in a browser automatically
after <code><a href="../reference/SS_plots.html">SS_plots()</a></code> creates all PNG and HTML files.</p>
<div class="float">
<img src="r4ss_html_capture.png" style="width:75.0%" alt="Illustration of the HTML view of the plots created by the SS_plots() function."><div class="figcaption">Illustration of the HTML view of the plots
created by the <code><a href="../reference/SS_plots.html">SS_plots()</a></code> function.</div>
</div>
<div class="section level3">
<h3 id="creating-select-plots">Creating select plots<a class="anchor" aria-label="anchor" href="#creating-select-plots"></a>
</h3>
<p><code><a href="../reference/SS_plots.html">SS_plots()</a></code> runs slowly due to the large number of plots
created. If only a few plots are of interest, it is more efficient to
plot only the necessary ones. Groups of plots to generate in the call to
<code><a href="../reference/SS_plots.html">SS_plots()</a></code> can be specified through the <code>plot</code>
argument. For example, if only the plots of Catch were desired,
call:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/SS_plots.html">SS_plots</a></span><span class="op">(</span>replist <span class="op">=</span> <span class="va">replist</span>, plot <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<p>If only plots of catch and discards were desired, the user could
call:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/SS_plots.html">SS_plots</a></span><span class="op">(</span>replist <span class="op">=</span> <span class="va">replist</span>, plot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The documentation for the <code>plot</code> argument in the help file
for <code><a href="../reference/SS_plots.html">SS_plots()</a></code> lists the corresponding numbers for each
group of plots.</p>
<p>It is not uncommon to run into bugs with the plotting functions
because of the vast number of model configurations available in SS3 and
plots created from them. A strategy with for dealing with a bug is to
exclude the set of plots where the bug is occurring as a temporary fix.
In the long term, bugs typically get attention fairly quickly from
maintainers when reported to the <a href="https://github.com/r4ss/r4ss/issues" class="external-link">r4ss issue tracker</a>. For
example, if there was a bug in the conditional age-at-length fits (plot
set 18), exclude the plot:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/SS_plots.html">SS_plots</a></span><span class="op">(</span><span class="va">replist</span>, plot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">17</span>, <span class="fl">19</span><span class="op">:</span><span class="fl">26</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="scripting-stock-synthesis-workflows-with-r4ss">Scripting Stock Synthesis workflows with <code>r4ss</code><a class="anchor" aria-label="anchor" href="#scripting-stock-synthesis-workflows-with-r4ss"></a>
</h2>
<p>Using functions in <code>r4ss</code>, a fully scripted workflow for
modifying Stock Synthesis files and running Stock Synthesis models is
possible.</p>
<p>We’ll demonstrate this by creating a new model from a model in the
<code>r4ss</code> package.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># initial model to modify</span></span>
<span><span class="va">mod_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"simple_small"</span><span class="op">)</span>, package <span class="op">=</span> <span class="st">"r4ss"</span><span class="op">)</span></span>
<span><span class="co"># create a new directory to put a new, modified version of the model</span></span>
<span><span class="va">new_mod_path</span> <span class="op">&lt;-</span> <span class="st">"simple_new"</span></span></code></pre></div>
<p>Use the r4ss utility function to copy over the model files from
<code>mod_path</code> to <code>new_mod_path</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/copy_SS_inputs.html">copy_SS_inputs</a></span><span class="op">(</span>dir.old <span class="op">=</span> <span class="va">mod_path</span>, dir.new <span class="op">=</span> <span class="va">new_mod_path</span><span class="op">)</span></span>
<span><span class="co">#&gt; copying files from</span></span>
<span><span class="co">#&gt;  /home/runner/work/_temp/Library/r4ss/extdata/simple_small</span></span>
<span><span class="co">#&gt; to</span></span>
<span><span class="co">#&gt;  simple_new</span></span>
<span><span class="co">#&gt; copying complete</span></span></code></pre></div>
<p>Note that the function <code><a href="../reference/populate_multiple_folders.html">populate_multiple_folders()</a></code> can
be used to copy several folders of Stock Synthesis model inputs.</p>
<div class="section level3">
<h3 id="read-in-stock-synthesis-files">Read in Stock Synthesis files<a class="anchor" aria-label="anchor" href="#read-in-stock-synthesis-files"></a>
</h3>
<p>Stock Synthesis files can be read in as list objects in R using the
<code><a href="../reference/SS_read.html">SS_read()</a></code> function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inputs</span> <span class="op">&lt;-</span> <span class="fu">r4ss</span><span class="fu">::</span><span class="fu"><a href="../reference/SS_read.html">SS_read</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="va">new_mod_path</span><span class="op">)</span></span>
<span><span class="co"># can also separately run the functions called by SS_read():</span></span>
<span><span class="co"># SS_readstarter(), SS_readdat(), SS_readctl(), SS_readforecast(),</span></span>
<span><span class="co"># and SS_readwtatage()</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="investigate-the-model">Investigate the model<a class="anchor" aria-label="anchor" href="#investigate-the-model"></a>
</h3>
<p>Each of the input files is read into R as a list which are then
grouped as a larger list. The components of the list should be in the
same order as they appear in the text file. Use <code><a href="https://rdrr.io/r/base/names.html" class="external-link">names()</a></code> to
see all the list components:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">inputs</span><span class="op">)</span> <span class="co"># see the elements of the big list</span></span>
<span><span class="co">#&gt; [1] "dir"   "path"  "dat"   "ctl"   "start" "fore"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">inputs</span><span class="op">$</span><span class="va">start</span><span class="op">)</span> <span class="co"># see names of the list components of starter file</span></span>
<span><span class="co">#&gt;  [1] "sourcefile"             "type"                   "SSversion"             </span></span>
<span><span class="co">#&gt;  [4] "datfile"                "ctlfile"                "init_values_src"       </span></span>
<span><span class="co">#&gt;  [7] "run_display_detail"     "detailed_age_structure" "checkup"               </span></span>
<span><span class="co">#&gt; [10] "parmtrace"              "cumreport"              "prior_like"            </span></span>
<span><span class="co">#&gt; [13] "soft_bounds"            "N_bootstraps"           "last_estimation_phase" </span></span>
<span><span class="co">#&gt; [16] "MCMCburn"               "MCMCthin"               "jitter_fraction"       </span></span>
<span><span class="co">#&gt; [19] "minyr_sdreport"         "maxyr_sdreport"         "N_STD_yrs"             </span></span>
<span><span class="co">#&gt; [22] "converge_criterion"     "retro_yr"               "min_age_summary_bio"   </span></span>
<span><span class="co">#&gt; [25] "depl_basis"             "depl_denom_frac"        "SPR_basis"             </span></span>
<span><span class="co">#&gt; [28] "F_report_units"         "F_age_range"            "F_report_basis"        </span></span>
<span><span class="co">#&gt; [31] "MCMC_output_detail"     "ALK_tolerance"          "final"                 </span></span>
<span><span class="co">#&gt; [34] "seed"</span></span></code></pre></div>
<p>Or reference a specific element to see the components. For example,
we can look at the mortality and growth parameter section
(MG_parms):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inputs</span><span class="op">$</span><span class="va">ctl</span><span class="op">$</span><span class="va">MG_parms</span></span>
<span><span class="co">#&gt;                         LO        HI        INIT       PRIOR PR_SD PR_type</span></span>
<span><span class="co">#&gt; NatM_p_1_Fem_GP_1    5e-02  0.150000  0.10000000  0.10000000   0.8       0</span></span>
<span><span class="co">#&gt; L_at_Amin_Fem_GP_1  -1e+01 45.000000 22.76900000 36.00000000  10.0       0</span></span>
<span><span class="co">#&gt; L_at_Amax_Fem_GP_1   4e+01 90.000000 71.80720000 70.00000000  10.0       0</span></span>
<span><span class="co">#&gt; VonBert_K_Fem_GP_1   5e-02  0.250000  0.14216500  0.15000000   0.8       0</span></span>
<span><span class="co">#&gt; CV_young_Fem_GP_1    5e-02  0.250000  0.10000000  0.10000000   0.8       0</span></span>
<span><span class="co">#&gt; CV_old_Fem_GP_1      5e-02  0.250000  0.10000000  0.10000000   0.8       0</span></span>
<span><span class="co">#&gt; Wtlen_1_Fem_GP_1    -3e+00  3.000000  0.00000244  0.00000244   0.8       0</span></span>
<span><span class="co">#&gt; Wtlen_2_Fem_GP_1    -3e+00  4.000000  3.34694000  3.34694000   0.8       0</span></span>
<span><span class="co">#&gt; Mat50%_Fem_GP_1      5e+01 60.000000 55.00000000 55.00000000   0.8       0</span></span>
<span><span class="co">#&gt; Mat_slope_Fem_GP_1  -3e+00  3.000000 -0.25000000 -0.25000000   0.8       0</span></span>
<span><span class="co">#&gt; Eggs_alpha_Fem_GP_1 -3e+00  3.000000  1.00000000  1.00000000   0.8       0</span></span>
<span><span class="co">#&gt; Eggs_beta_Fem_GP_1  -3e+00  3.000000  0.00000000  0.00000000   0.8       0</span></span>
<span><span class="co">#&gt; NatM_p_1_Mal_GP_1   -3e+00  3.000000  0.00000000  0.00000000  99.0       0</span></span>
<span><span class="co">#&gt; L_at_Amin_Mal_GP_1  -3e+00  3.000000  0.00000000  0.00000000  99.0       0</span></span>
<span><span class="co">#&gt; L_at_Amax_Mal_GP_1  -3e+00  3.000000  0.00000000  0.00000000  99.0       0</span></span>
<span><span class="co">#&gt; VonBert_K_Mal_GP_1  -3e+00  3.000000  0.00000000  0.00000000  99.0       0</span></span>
<span><span class="co">#&gt; CV_young_Mal_GP_1   -3e+00  3.000000  0.00000000  0.00000000  99.0       0</span></span>
<span><span class="co">#&gt; CV_old_Mal_GP_1     -3e+00  3.000000  0.00000000  0.00000000  99.0       0</span></span>
<span><span class="co">#&gt; Wtlen_1_Mal_GP_1    -3e+00  3.000000  0.00000244  0.00000244   0.8       0</span></span>
<span><span class="co">#&gt; Wtlen_2_Mal_GP_1    -3e+00  4.000000  3.34694000  3.34694000   0.8       0</span></span>
<span><span class="co">#&gt; CohortGrowDev        1e-01 10.000000  1.00000000  1.00000000   1.0       0</span></span>
<span><span class="co">#&gt; FracFemale_GP_1      1e-06  0.999999  0.50000000  0.50000000   0.5       0</span></span>
<span><span class="co">#&gt;                     PHASE env_var&amp;link dev_link dev_minyr dev_maxyr dev_PH</span></span>
<span><span class="co">#&gt; NatM_p_1_Fem_GP_1      -3            0        0         0         0      0</span></span>
<span><span class="co">#&gt; L_at_Amin_Fem_GP_1      2            0        0         0         0      0</span></span>
<span><span class="co">#&gt; L_at_Amax_Fem_GP_1      4            0        0         0         0      0</span></span>
<span><span class="co">#&gt; VonBert_K_Fem_GP_1      4            0        0         0         0      0</span></span>
<span><span class="co">#&gt; CV_young_Fem_GP_1      -3            0        0         0         0      0</span></span>
<span><span class="co">#&gt; CV_old_Fem_GP_1        -3            0        0         0         0      0</span></span>
<span><span class="co">#&gt; Wtlen_1_Fem_GP_1       -3            0        0         0         0      0</span></span>
<span><span class="co">#&gt; Wtlen_2_Fem_GP_1       -3            0        0         0         0      0</span></span>
<span><span class="co">#&gt; Mat50%_Fem_GP_1        -3            0        0         0         0      0</span></span>
<span><span class="co">#&gt; Mat_slope_Fem_GP_1     -3            0        0         0         0      0</span></span>
<span><span class="co">#&gt; Eggs_alpha_Fem_GP_1    -3            0        0         0         0      0</span></span>
<span><span class="co">#&gt; Eggs_beta_Fem_GP_1     -3            0        0         0         0      0</span></span>
<span><span class="co">#&gt; NatM_p_1_Mal_GP_1      -3            0        0         0         0      0</span></span>
<span><span class="co">#&gt; L_at_Amin_Mal_GP_1     -3            0        0         0         0      0</span></span>
<span><span class="co">#&gt; L_at_Amax_Mal_GP_1     -3            0        0         0         0      0</span></span>
<span><span class="co">#&gt; VonBert_K_Mal_GP_1     -3            0        0         0         0      0</span></span>
<span><span class="co">#&gt; CV_young_Mal_GP_1      -3            0        0         0         0      0</span></span>
<span><span class="co">#&gt; CV_old_Mal_GP_1        -3            0        0         0         0      0</span></span>
<span><span class="co">#&gt; Wtlen_1_Mal_GP_1       -3            0        0         0         0      0</span></span>
<span><span class="co">#&gt; Wtlen_2_Mal_GP_1       -3            0        0         0         0      0</span></span>
<span><span class="co">#&gt; CohortGrowDev          -1            0        0         0         0      0</span></span>
<span><span class="co">#&gt; FracFemale_GP_1       -99            0        0         0         0      0</span></span>
<span><span class="co">#&gt;                     Block Block_Fxn</span></span>
<span><span class="co">#&gt; NatM_p_1_Fem_GP_1       0         0</span></span>
<span><span class="co">#&gt; L_at_Amin_Fem_GP_1      0         0</span></span>
<span><span class="co">#&gt; L_at_Amax_Fem_GP_1      0         0</span></span>
<span><span class="co">#&gt; VonBert_K_Fem_GP_1      0         0</span></span>
<span><span class="co">#&gt; CV_young_Fem_GP_1       0         0</span></span>
<span><span class="co">#&gt; CV_old_Fem_GP_1         0         0</span></span>
<span><span class="co">#&gt; Wtlen_1_Fem_GP_1        0         0</span></span>
<span><span class="co">#&gt; Wtlen_2_Fem_GP_1        0         0</span></span>
<span><span class="co">#&gt; Mat50%_Fem_GP_1         0         0</span></span>
<span><span class="co">#&gt; Mat_slope_Fem_GP_1      0         0</span></span>
<span><span class="co">#&gt; Eggs_alpha_Fem_GP_1     0         0</span></span>
<span><span class="co">#&gt; Eggs_beta_Fem_GP_1      0         0</span></span>
<span><span class="co">#&gt; NatM_p_1_Mal_GP_1       0         0</span></span>
<span><span class="co">#&gt; L_at_Amin_Mal_GP_1      0         0</span></span>
<span><span class="co">#&gt; L_at_Amax_Mal_GP_1      0         0</span></span>
<span><span class="co">#&gt; VonBert_K_Mal_GP_1      0         0</span></span>
<span><span class="co">#&gt; CV_young_Mal_GP_1       0         0</span></span>
<span><span class="co">#&gt; CV_old_Mal_GP_1         0         0</span></span>
<span><span class="co">#&gt; Wtlen_1_Mal_GP_1        0         0</span></span>
<span><span class="co">#&gt; Wtlen_2_Mal_GP_1        0         0</span></span>
<span><span class="co">#&gt; CohortGrowDev           0         0</span></span>
<span><span class="co">#&gt; FracFemale_GP_1         0         0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="modify-the-model">Modify the model<a class="anchor" aria-label="anchor" href="#modify-the-model"></a>
</h3>
<p>You could make basic or large structural changes to your model in R.
For example, the initial value of M can be changed:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># view the initial value</span></span>
<span><span class="va">inputs</span><span class="op">$</span><span class="va">ctl</span><span class="op">$</span><span class="va">MG_parms</span><span class="op">[</span><span class="st">"NatM_p_1_Fem_GP_1"</span>, <span class="st">"INIT"</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 0.1</span></span>
<span><span class="co"># change it to 0.2</span></span>
<span><span class="va">inputs</span><span class="op">$</span><span class="va">ctl</span><span class="op">$</span><span class="va">MG_parms</span><span class="op">[</span><span class="st">"NatM_p_1_Fem_GP_1"</span>, <span class="st">"INIT"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.2</span></span></code></pre></div>
<p>When making large structural changes, additional elements may need to
be added that were NULL before. To find out the names in the r4ss list
object, it may be necessary to make changes directly to the input files
and then read it in again to R, or to look at the source code for the
names of the list elements. For example, the source code for
<code><a href="../reference/SS_readctl.html">SS_readctl()</a></code> when using a SS3.30 file is located at <a href="https://github.com/r4ss/r4ss/blob/main/R/SS_readctl_3.30.R" class="external-link">https://github.com/r4ss/r4ss/blob/main/R/SS_readctl_3.30.R</a>.</p>
<p>Settings in other files can also be modified. For example, the
biomass target can be modified in the forecast file</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inputs</span><span class="op">$</span><span class="va">fore</span><span class="op">$</span><span class="va">Btarget</span></span>
<span><span class="co">#&gt; [1] 0.4</span></span>
<span><span class="va">inputs</span><span class="op">$</span><span class="va">fore</span><span class="op">$</span><span class="va">Btarget</span> <span class="op">&lt;-</span> <span class="fl">0.45</span></span>
<span><span class="va">inputs</span><span class="op">$</span><span class="va">fore</span><span class="op">$</span><span class="va">Btarget</span></span>
<span><span class="co">#&gt; [1] 0.45</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="write-out-the-modified-models">Write out the modified models<a class="anchor" aria-label="anchor" href="#write-out-the-modified-models"></a>
</h3>
<p>The <code><a href="../reference/SS_write.html">SS_write()</a></code> function can be used to write out the
modified stock synthesis input R objects into input files:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">r4ss</span><span class="fu">::</span><span class="fu"><a href="../reference/SS_write.html">SS_write</a></span><span class="op">(</span><span class="va">inputs</span>, dir <span class="op">=</span> <span class="va">new_mod_path</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>If you make changes to the input model files that render the file
unparsable by Stock Synthesis, the <code><a href="../reference/SS_write.html">SS_write()</a></code> function may
throw an error (and hopefully provide an informative message about why).
However, it is possible that an invalid Stock Synthesis model file could
be written, so the true test is whether or not it is possible to run
Stock Synthesis with the modified model files.</p>
<p>If you need help troubleshooting <code><a href="../reference/SS_read.html">SS_read()</a></code> or
<code><a href="../reference/SS_write.html">SS_write()</a></code> and the associated functions for each model
file, or would like to report a bug, please <a href="https://github.com/r4ss/r4ss/issues" class="external-link">post an issue in the r4ss
repository</a>.</p>
</div>
<div class="section level3">
<h3 id="download-the-stock-synthesis-executable-from-github">Download the Stock Synthesis executable from GitHub<a class="anchor" aria-label="anchor" href="#download-the-stock-synthesis-executable-from-github"></a>
</h3>
<p>The <a href="https://github.com/nmfs-ost/ss3-source-code/releases/latest" class="external-link">latest
release of the Stock Synthesis executable</a> or other releases found by
entering a character string of a version tag (list of tags is available
<a href="https://github.com/nmfs-ost/ss3-source-code/tags" class="external-link">here</a>) can
be downloaded from the Stock Synthesis GitHub page using the
function:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Default with no version downloads the latest release</span></span>
<span><span class="fu">r4ss</span><span class="fu">::</span><span class="fu"><a href="../reference/get_ss3_exe.html">get_ss3_exe</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download the latest release to a specific directory</span></span>
<span><span class="fu">r4ss</span><span class="fu">::</span><span class="fu"><a href="../reference/get_ss3_exe.html">get_ss3_exe</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="va">new_mod_path</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Adding a character string for a specific version using the GitHub tag</span></span>
<span><span class="fu">r4ss</span><span class="fu">::</span><span class="fu"><a href="../reference/get_ss3_exe.html">get_ss3_exe</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="va">new_mod_path</span>, version <span class="op">=</span> <span class="st">"v3.30.18"</span><span class="op">)</span></span></code></pre></div>
<p>You can also use the function without a specified directory which
will download the executable to your working directory. This function
downloads the correct executable according to information it gets about
your operating system.</p>
</div>
<div class="section level3">
<h3 id="run-the-modified-model">Run the modified model<a class="anchor" aria-label="anchor" href="#run-the-modified-model"></a>
</h3>
<p>The model can now be run with Stock Synthesis. The call to do this
depends on where the Stock Synthesis executable is on your computer. If
the Stock Synthesis executable is in the same folder as the model that
will be run, <code><a href="../reference/run.html">run()</a></code> can be used. Assuming the stock
synthesis executable is called ss.exe:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">r4ss</span><span class="fu">::</span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="va">new_mod_path</span>, skipfinished <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Note this is similar to resetting the working directory and running
the model with <code><a href="https://rdrr.io/r/base/system.html" class="external-link">system()</a></code> or <code>shell()</code>, but deals
with differences among operating systems automatically. Another
advantage of <code><a href="../reference/run.html">run()</a></code> is that there is no need to change the
working directory.</p>
<p>If the executable in a different folder than the model, specify
either the absolute or relative path to the executable. Note that
executables for v3.30.22.1 and after are named ss3.exe, ss3_linux, and
ss3_osx <em>unless</em> you download the executables using
<code><a href="../reference/get_ss3_exe.html">get_ss3_exe()</a></code> which gives them the names ss3.exe (for
windows) and ss3 (for linux/osx) regardless of the version.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use the absolute exe path in the call on a Windows computer.</span></span>
<span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="va">new_mod_path</span>, exe <span class="op">=</span> <span class="st">"c:/SS/SSv3.30.19.01_Apr15/ss.exe"</span><span class="op">)</span></span>
<span><span class="co"># use the absolute exe path in the call on linux.</span></span>
<span><span class="fu"><a href="../reference/run.html">run</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="va">new_mod_path</span>, exe <span class="op">=</span> <span class="st">"~/SS/SSv3.30.19.01_Apr15/ss_linux"</span><span class="op">)</span></span></code></pre></div>
<p>Finally, if the stock synthesis executable is in your PATH, then
<code><a href="../reference/run.html">run()</a></code> should find it automatically.</p>
</div>
<div class="section level3">
<h3 id="investigate-the-model-run">Investigate the model run<a class="anchor" aria-label="anchor" href="#investigate-the-model-run"></a>
</h3>
<p>As <a href="#plot">previously</a>, <code><a href="../reference/SS_output.html">SS_output()</a></code> and
<code><a href="../reference/SS_plots.html">SS_plots()</a></code> can be used to investigate the model
results.</p>
</div>
<div class="section level3">
<h3 id="should-i-script-my-whole-stock-synthesis-workflow">Should I script my whole Stock Synthesis workflow?<a class="anchor" aria-label="anchor" href="#should-i-script-my-whole-stock-synthesis-workflow"></a>
</h3>
<p>Scripting using r4ss functions is one way of developing a
reproducible and coherent Stock Synthesis development workflow. However,
there are many ways that Stock Synthesis models could be run and
modified. What is most important is that you find a workflow that works
for you and that you are able to document changes being made to a model.
Version control (such as <a href="https://git-scm.com/" class="external-link">git</a>) is
another tool that may help document changes to models.</p>
</div>
</div>
<div class="section level2">
<h2 id="functions-for-common-stock-assessment-tasks">Functions for common stock assessment tasks<a class="anchor" aria-label="anchor" href="#functions-for-common-stock-assessment-tasks"></a>
</h2>
<p>While stock assessment processes differ among regions, some modeling
workflows and diagnostics are commonly used. Within r4ss, there are
functions to perform a retrospective (<code><a href="../reference/retro.html">retro()</a></code>), jitter the
starting values and reoptimize the stock assessment model a number of
times to check for local minima (<code><a href="../reference/jitter.html">jitter()</a></code>) and tuning
composition data (<code><a href="../reference/tune_comps.html">tune_comps()</a></code>).</p>
<p>Additional model diagnostics for Stock Synthesis models are available
as part of the <a href="https://github.com/jabbamodel/ss3diags" class="external-link">ss3diags</a> package.</p>
<div class="section level3">
<h3 id="running-retrospectives">Running retrospectives<a class="anchor" aria-label="anchor" href="#running-retrospectives"></a>
</h3>
<p>A retrospective analysis removes a certain number of years of the
model data and recalculates the fit. This is typically done several
times and the results are used to look for retrospective patterns (i.e.,
non-random deviations in estimated parameters or derived quantities as
years of data are removed). If the model results change drastically and
non-randomly as data is removed, this is less support for the model. For
more on the theory and details behind retrospective analyses, see <a href="https://doi.org/10.1093/icesjms/fsu198" class="external-link">Hurtado-Ferro et
al. 2015</a> and <a href="https://doi.org/10.1093/icesjms/fsaa184" class="external-link">Legault 2020</a>.</p>
<p>The function <code><a href="../reference/retro.html">retro()</a></code> can be used to run retrospective
analyses starting from an existing Stock Synthesis model. Note that it
is safest to create a copy of your original Stock Synthesis model that
the retrospective is run on, just in case there are problems with the
run. For example, a five year retrospective could be done:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a temporary path for the retrospective analyses to run and download the</span></span>
<span><span class="co"># ss3 exe</span></span>
<span><span class="va">old_mod_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"simple_small"</span><span class="op">)</span>, package <span class="op">=</span> <span class="st">"r4ss"</span><span class="op">)</span></span>
<span><span class="va">new_mod_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">all_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">old_mod_path</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">all_files</span>, to <span class="op">=</span> <span class="va">new_mod_path</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/get_ss3_exe.html">get_ss3_exe</a></span><span class="op">(</span>dir <span class="op">=</span> <span class="va">new_mod_path</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run the retrospective analyses</span></span>
<span><span class="fu"><a href="../reference/retro.html">retro</a></span><span class="op">(</span></span>
<span>  dir <span class="op">=</span> <span class="va">new_mod_path</span>, <span class="co"># wherever the model files are</span></span>
<span>  oldsubdir <span class="op">=</span> <span class="st">""</span>, <span class="co"># subfolder within dir</span></span>
<span>  newsubdir <span class="op">=</span> <span class="st">"retrospectives"</span>, <span class="co"># new place to store retro runs within dir</span></span>
<span>  years <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="op">-</span><span class="fl">5</span>, <span class="co"># years relative to ending year of model</span></span>
<span>  exe <span class="op">=</span> <span class="st">"ss3"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After running this retrospective, six new folders would be created
within a new “retrospectives” directory, where each folder would contain
a different run of the retrospective (removing 0 to 5 years of
data).</p>
<p>After the retrospective models have run, the results can be used as a
diagnostic:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the 6 models</span></span>
<span><span class="va">retroModels</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SSgetoutput.html">SSgetoutput</a></span><span class="op">(</span>dirvec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span></span>
<span>  <span class="va">new_mod_path</span>, <span class="st">"retrospectives"</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"retro"</span>, <span class="fl">0</span><span class="op">:</span><span class="op">-</span><span class="fl">5</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># summarize the model results</span></span>
<span><span class="va">retroSummary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SSsummarize.html">SSsummarize</a></span><span class="op">(</span><span class="va">retroModels</span><span class="op">)</span></span>
<span><span class="co"># create a vector of the ending year of the retrospectives</span></span>
<span><span class="va">endyrvec</span> <span class="op">&lt;-</span> <span class="va">retroSummary</span><span class="op">[[</span><span class="st">"endyrs"</span><span class="op">]</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0</span><span class="op">:</span><span class="op">-</span><span class="fl">5</span></span>
<span><span class="co"># make plots comparing the 6 models</span></span>
<span><span class="co"># showing 2 out of the 17 plots done by SSplotComparisons</span></span>
<span><span class="fu"><a href="../reference/SSplotComparisons.html">SSplotComparisons</a></span><span class="op">(</span><span class="va">retroSummary</span>,</span>
<span>  endyrvec <span class="op">=</span> <span class="va">endyrvec</span>,</span>
<span>  legendlabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Data"</span>, <span class="fl">0</span><span class="op">:</span><span class="op">-</span><span class="fl">5</span>, <span class="st">"years"</span><span class="op">)</span>,</span>
<span>  subplot <span class="op">=</span> <span class="fl">2</span>, <span class="co"># only show one plot in vignette</span></span>
<span>  print <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># send plots to PNG file</span></span>
<span>  plot <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># don't plot to default graphics device</span></span>
<span>  plotdir <span class="op">=</span> <span class="va">new_mod_path</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html" class="external-link">include_graphics</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">new_mod_path</span>, <span class="st">"compare2_spawnbio_uncertainty.png"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="compare2_spawnbio_uncertainty.png" style="width:75.0%" alt="Illustration of the second comparison plot created by the SSplotComparisons() function."><div class="figcaption">Illustration of the second comparison plot
created by the <code><a href="../reference/SSplotComparisons.html">SSplotComparisons()</a></code> function.</div>
</div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate Mohn's rho, a diagnostic value</span></span>
<span><span class="va">rho_output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SSmohnsrho.html">SSmohnsrho</a></span><span class="op">(</span></span>
<span>  summaryoutput <span class="op">=</span> <span class="va">retroSummary</span>,</span>
<span>  endyrvec <span class="op">=</span> <span class="va">endyrvec</span>,</span>
<span>  startyr <span class="op">=</span> <span class="va">retroSummary</span><span class="op">[[</span><span class="st">"endyrs"</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fl">5</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="jittering">Jittering<a class="anchor" aria-label="anchor" href="#jittering"></a>
</h3>
<p>Another commonly used diagnostic with Stock Synthesis models is
“jittering”. Model initial values are changed randomly (by some fraction
in a transformed parameter space) and the model is reoptimized. The
<code><a href="../reference/jitter.html">jitter()</a></code> function performs this routine for the number of
times specified by the user. For a stock Synthesis model in a folder
called <code>jitter_dir</code> jittering starting values can be run 100
times (note this could take a while as they will be run in
sequence):</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a new directory</span></span>
<span><span class="va">jitter_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mod_path</span>, <span class="st">"jitter"</span><span class="op">)</span></span>
<span><span class="co"># copy over the stock synthesis model files to the new directory</span></span>
<span><span class="fu"><a href="../reference/copy_SS_inputs.html">copy_SS_inputs</a></span><span class="op">(</span>dir.old <span class="op">=</span> <span class="va">mod_path</span>, dir.new <span class="op">=</span> <span class="va">jitter_dir</span><span class="op">)</span></span>
<span><span class="co"># run the jitters</span></span>
<span><span class="va">jitter_loglike</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/jitter.html">jitter</a></span><span class="op">(</span></span>
<span>  dir <span class="op">=</span> <span class="va">jitter_dir</span>,</span>
<span>  Njitter <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  jitter_fraction <span class="op">=</span> <span class="fl">0.1</span> <span class="co"># a typically used jitter fraction</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The output from <code><a href="../reference/jitter.html">jitter()</a></code> is saved in
<code>jitter_loglike</code>, which is a table of the different negative
log likelihoods produced from jittering. If there are any negative log
likelihoods smaller than the original model’s log likelihood, this
indicates that the original model’s log likelihood is a local minimum
and not the global minimum. On the other hand, if there are no log
likelihoods lower than the original model’s log likelihood, then this is
evidence (but not proof) that the original model’s negative log
likelihood could be the global minimum.</p>
<p>Jittering starting values can also provide evidence about the
sensitivity of the model to starting values. If many different
likelihood values are arrived at during the jitter analysis, then the
model is sensitive to starting values. However, if many of the models
converge to the same negative log likelihood value, this indicates the
model is less sensitive to starting values.</p>
</div>
<div class="section level3">
<h3 id="tuning-composition-data">Tuning composition data<a class="anchor" aria-label="anchor" href="#tuning-composition-data"></a>
</h3>
<p>Three different routines are available to tune (or weight)
composition data in Stock Synthesis. The McAllister-Ianelli (MI) and
Francis tuning methods are iterative reweighting routines, while the
Dirichlet-multinomial (DM) option incorporates weighting parameters
directly in the original model.</p>
<p>Because tuning is commonly used with Stock Synthesis models, and
users may be interested in exploring the same model, but using different
tuning methods, <code><a href="../reference/tune_comps.html">tune_comps()</a></code> can start from the same model
and transform it into different tuning methods.</p>
<p>As an example, we will illustrate how to run Francis tuning on an
example Stock Synthesis model built into the r4ss package. First, we
make a copy of the model to avoid changing the original model files</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define a new directory in a temporary location</span></span>
<span><span class="va">mod_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"simple_mod"</span><span class="op">)</span></span>
<span><span class="co"># Path to simple model in r4ss and copy files to mod_path</span></span>
<span><span class="va">example_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"simple_small"</span>, package <span class="op">=</span> <span class="st">"r4ss"</span><span class="op">)</span></span>
<span><span class="co"># copy model input files</span></span>
<span><span class="fu"><a href="../reference/copy_SS_inputs.html">copy_SS_inputs</a></span><span class="op">(</span>dir.old <span class="op">=</span> <span class="va">example_path</span>, dir.new <span class="op">=</span> <span class="va">mod_path</span><span class="op">)</span></span>
<span><span class="co">#&gt; copying files from</span></span>
<span><span class="co">#&gt;  /home/runner/work/_temp/Library/r4ss/extdata/simple_small</span></span>
<span><span class="co">#&gt; to</span></span>
<span><span class="co">#&gt;  /tmp/RtmpAfjguP/simple_mod</span></span>
<span><span class="co">#&gt; copying complete</span></span>
<span><span class="co"># copy over the Report file to provide information about the last run</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">example_path</span>, <span class="st">"Report.sso"</span><span class="op">)</span>,</span>
<span>  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mod_path</span>, <span class="st">"Report.sso"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co"># copy comp report file  to provide information about the last run of this model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">example_path</span>, <span class="st">"CompReport.sso"</span><span class="op">)</span>,</span>
<span>  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mod_path</span>, <span class="st">"CompReport.sso"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>The following call to <code><a href="../reference/tune_comps.html">tune_comps()</a></code> runs Francis
weighting for 1 iteration and allows upweighting. Assume that an
executable called “ss or ss.exe” is available in the mod_path
folder.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tune_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_comps.html">tune_comps</a></span><span class="op">(</span></span>
<span>  option <span class="op">=</span> <span class="st">"Francis"</span>,</span>
<span>  niters_tuning <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  dir <span class="op">=</span> <span class="va">mod_path</span>,</span>
<span>  allow_up_tuning <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># see the tuning table, and the weights applied to the model.</span></span>
<span><span class="va">tune_info</span></span></code></pre></div>
<p>Now, suppose we wanted to run the same model, but using
Dirichlet-multinomial parameters to weight. The model can be copied over
to a new folder, then the <code><a href="../reference/tune_comps.html">tune_comps()</a></code> function could be
used to add Dirichlet-multinomial parameters (1 for each fleet with
composition data and for each type of composition data) and re-run the
model.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create additional temporary directory</span></span>
<span><span class="va">mod_path_dm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"simple_mod_dm"</span><span class="op">)</span></span>
<span><span class="co"># copy model files</span></span>
<span><span class="fu"><a href="../reference/copy_SS_inputs.html">copy_SS_inputs</a></span><span class="op">(</span>dir.old <span class="op">=</span> <span class="va">mod_path</span>, dir.new <span class="op">=</span> <span class="va">mod_path_dm</span>, copy_exe <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># copy over the Report file to provide information about the last run</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mod_path</span>, <span class="st">"Report.sso"</span><span class="op">)</span>,</span>
<span>  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mod_path_dm</span>, <span class="st">"Report.sso"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># copy comp report file  to provide information about the last run of this model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mod_path</span>, <span class="st">"CompReport.sso"</span><span class="op">)</span>,</span>
<span>  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mod_path_dm</span>, <span class="st">"CompReport.sso"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Add Dirichlet-multinomial parameters and rerun. The function will</span></span>
<span><span class="co"># automatically remove the MI weighting and add in the DM parameters.</span></span>
<span><span class="va">DM_parm_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tune_comps.html">tune_comps</a></span><span class="op">(</span></span>
<span>  option <span class="op">=</span> <span class="st">"DM"</span>,</span>
<span>  niters_tuning <span class="op">=</span> <span class="fl">1</span>, <span class="co"># must be 1 or greater to run, through DM is not iterative</span></span>
<span>  dir <span class="op">=</span> <span class="va">mod_path_dm</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># see the DM parameter estimates</span></span>
<span><span class="va">DM_parm_info</span><span class="op">[[</span><span class="st">"tuning_table_list"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>There are many options in the <code><a href="../reference/tune_comps.html">tune_comps()</a></code> function;
please see the documentation (<code><a href="../reference/tune_comps.html">?tune_comps</a></code> in the R console)
for more details and examples.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ian G. Taylor, Ian J. Stewart, Allan C. Hicks, Tommy M. Garrison, Andre E. Punt, R.I.C. Chris Francis, John R. Wallace, Chantel R. Wetzel, James T. Thorson, Yukio Takeuchi, Kotaro Ono, Cole C. Monnahan, Christine C. Stawitz, Z. Teresa A’mar, Athol R. Whitten, Kelli F. Johnson, Robbie L. Emmet, Sean C. Anderson, Gwladys I. Lambert, Megan M. Stachura, Andrew B. Cooper, Andi Stephens, Neil L. Klaer, Carey R. McGilliard, Iago Mosqueira, Watal M. Iwasaki, Kathryn L. Doering, Andrea M. Havron, Nathan R. Vaughan, LaTreese S. Denson, Ashleigh J. Novak, Henning Winker, Lee Qi, Megumi Oshima, Eric Fletcher, Elizabeth F. Gugliotti, Kiva L. Oken.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
